# This profiler is meant to be used on the NYC taxi data (yellow_trip_data_sample_2019-*.csv)
variables:
  # BatchRequest yielding two batches (January, 2019 and February, 2019 trip data)
  jan_feb_2019_trip_data_batch_request:
    # We want to use the same triumvirate as in the user's batch_request (i.e., the one passed in the Validator).
    # However, a bug in Batch creation (not always setting BatchDefinition) is preventing this, until the bug is fixed.
    datasource_name: taxi_pandas
    data_connector_name: monthly
    data_asset_name: my_reports
    data_connector_query:
      index: ":-1"
  nan_raises_exception: False  # Choices: False (default) or True (if False, then NaN is converted to 0.0).
  false_positive_rate: 1.0e-2
  mostly: 1.0

rules:
  row_count_range_rule:
    domain_builder:
      class_name: ActiveBatchTableDomainBuilder
    parameter_builders:
      - parameter_name: row_count_range
        class_name: NumericMetricRangeMultiBatchParameterBuilder
        batch_request: $variables.jan_feb_2019_trip_data_batch_request
        metric_name: table.row_count
        metric_domain_kwargs: $domain.domain_kwargs
        sampling_method: bootstrap  # bootstrap (default) and oneshot are supported
        nan_raises_exception: $variables.nan_raises_exception
        false_positive_rate: $variables.false_positive_rate
        round_decimals: 0
        truncate_distribution:
          lower_bound: 0
    expectation_configuration_builders:
      - expectation_type: expect_table_row_count_to_be_between
        class_name: DefaultExpectationConfigurationBuilder
        module_name: great_expectations.rule_based_profiler.expectation_configuration_builder
        min_value: $parameter.row_count_range.value.min_value
        max_value: $parameter.row_count_range.value.max_value
        mostly: $variables.mostly
        meta:
          profiler_details: $parameter.row_count_range.details
  column_ranges_rule:
    domain_builder:
      class_name: SimpleSemanticTypeColumnDomainBuilder
      semantic_types:
        - numeric
    parameter_builders:
      - parameter_name: min_range
        class_name: NumericMetricRangeMultiBatchParameterBuilder
        batch_request: $variables.jan_feb_2019_trip_data_batch_request
        metric_name: column.min
        metric_domain_kwargs: $domain.domain_kwargs
        sampling_method: bootstrap
        nan_raises_exception: $variables.nan_raises_exception
        false_positive_rate: $variables.false_positive_rate
        round_decimals: 2
      - parameter_name: max_range
        class_name: NumericMetricRangeMultiBatchParameterBuilder
        batch_request: $variables.jan_feb_2019_trip_data_batch_request
        metric_name: column.max
        metric_domain_kwargs: $domain.domain_kwargs
        sampling_method: oneshot
        nan_raises_exception: $variables.nan_raises_exception
        false_positive_rate: $variables.false_positive_rate
        round_decimals: 2
    expectation_configuration_builders:
      - expectation_type: expect_column_min_to_be_between
        class_name: DefaultExpectationConfigurationBuilder
        module_name: great_expectations.rule_based_profiler.expectation_configuration_builder
        column: $domain.domain_kwargs.column
        min_value: $parameter.min_range.value.min_value
        max_value: $parameter.min_range.value.max_value
        mostly: $variables.mostly
        meta:
          profiler_details: $parameter.min_range.details
      - expectation_type: expect_column_max_to_be_between
        class_name: DefaultExpectationConfigurationBuilder
        module_name: great_expectations.rule_based_profiler.expectation_configuration_builder
        column: $domain.domain_kwargs.column
        min_value: $parameter.max_range.value.min_value
        max_value: $parameter.max_range.value.max_value
        mostly: $variables.mostly
        meta:
          profiler_details: $parameter.max_range.details
